<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Liquid Glass Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        @font-face {
            font-family: 'Dity Infant';
            src: url('./dityinfant-Regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100dvh; overflow: hidden; background: #0a0a0c; color: #e8e8e8; font-family: 'Dity Infant', system-ui, sans-serif; }
        
        /* Пульсирующий фон */
        .bg-lights { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
        .light {
            position: absolute; border-radius: 50%;
            background: radial-gradient(circle, rgba(160, 190, 255, 0.22) 0%, transparent 70%);
            filter: blur(90px); animation: pulse 12s ease-in-out infinite;
        }
        .light:nth-child(1) { width: 700px; height: 700px; top: -250px; left: -200px; }
        .light:nth-child(2) { width: 900px; height: 900px; top: 20%; right: -300px; animation-delay: 4s; }
        .light:nth-child(3) { width: 600px; height: 600px; bottom: -200px; left: 50%; animation-delay: 7s; }
        .light:nth-child(4) { width: 800px; height: 800px; top: 45%; left: 45%; animation-delay: 2s; opacity: 0.5; }

        @keyframes pulse {
            0%, 100% { opacity: 0.25; transform: scale(0.85); }
            50% { opacity: 0.65; transform: scale(1.25); }
        }

        .container { position: relative; z-index: 1; height: 100dvh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }

        /* Страницы */
        .page { display: none; width: 100%; max-width: 380px; }
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: none; } }

        /* Главная */
        .profile-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(28px);
            border: 1px solid rgba(255,255,255,0.14);
            border-radius: 34px;
            padding: 50px 40px 40px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        .avatar { width: 140px; height: 140px; border-radius: 50%; overflow: hidden; margin: 0 auto 28px;
                  border: 5px solid rgba(255,255,255,0.2); box-shadow: 0 0 40px rgba(180,200,255,0.3); }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .username { font-size: 32px; letter-spacing: 4px; margin-bottom: 10px; }
        .first-entry { font-size: 16px; opacity: 0.75; }

        /* Софт — Rocket Predictor */
        .predictor-card {
            background: rgba(255,255,255,0.09);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 32px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 25px 60px rgba(0,0,0,0.6);
        }

        .rocket-area {
            height: 180px;
            background: linear-gradient(to top, #ff4d4d22, transparent);
            border-radius: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .rocket {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 80px;
            filter: drop-shadow(0 0 20px #ff9500);
            transition: bottom 0.4s ease;
        }

        .multiplier {
            font-size: 68px;
            font-weight: bold;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #00ff9d, #00b8ff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .status {
            font-size: 18px;
            padding: 14px 30px;
            border-radius: 50px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            margin: 20px 0;
        }

        .btn-predict {
            margin-top: 30px;
            padding: 18px 50px;
            font-size: 20px;
            background: linear-gradient(135deg, #00ff9d, #00b8ff);
            color: #000;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Dity Infant', sans-serif;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,255,150,0.3);
            transition: all 0.3s;
        }
        .btn-predict:active { transform: scale(0.95); }

        /* Нижняя навигация */
        .bottom-nav {
            position: fixed;
            bottom: max(20px, env(safe-area-inset-bottom, 20px));
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.16);
            border-radius: 60px;
            padding: clamp(14px, 3vw, 20px) clamp(20px, 8vw, 50px);
            display: flex;
            gap: clamp(25px, 10vw, 56px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            z-index: 100;
            max-width: 95vw;
        }

        .nav-item { color: #999; text-align: center; transition: color 0.3s; cursor: pointer; user-select: none; }
        .nav-item.active { color: #ffffff; }
        .nav-icon { width: clamp(26px, 6vw, 34px); height: clamp(26px, 6vw, 34px); margin: 0 auto 6px; }
        .nav-label { font-size: clamp(11px, 3.2vw, 13px); font-weight: 500; }
    </style>
</head>
<body>

    <div class="bg-lights">
        <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
    </div>

    <div class="container">

        <!-- Главная -->
        <div id="page-home" class="page active">
            <div class="profile-card">
                <div class="avatar"><img id="user-avatar" src="" alt="Avatar"></div>
                <div class="username" id="user-name">// @loading //</div>
                <div class="first-entry" id="first-entry">Первый вход: загружается…</div>
            </div>
        </div>

        <!-- Софт — Rocket Predictor -->
        <div id="page-soft" class="page">
            <div class="predictor-card">
                <h2 style="font-size:28px; margin-bottom:10px;">Rocket Predictor</h2>
                <div class="rocket-area">
                    <div class="rocket" id="rocket">Rocket</div>
                </div>
                <div class="multiplier" id="multiplier">1.00×</div>
                <div class="status" id="status">Нажмите кнопку для прогноза</div>
                <button class="btn-predict" id="start-predict">Запустить прогноз</button>
            </div>
        </div>

    </div>

    <!-- Нижняя навигация (4 вкладки) -->
    <div class="bottom-nav">
        <div class="nav-item active" data-page="page-home">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            <div class="nav-label">Главная</div>
        </div>

        <div class="nav-item" data-page="page-info">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
            </svg>
            <div class="nav-label">Инфо</div>
        </div>

        <div class="nav-item" data-page="page-sub">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.76 1.38-.24 3.15 1.14 3.95C7.66 18.66 9.38 19 11.1 19h12v-2H11.1l.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16h-2v-2h2v2z"/>
            </svg>
            <div class="nav-label">Подписка</div>
        </div>

        <div class="nav-item" data-page="page-soft">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L2 22h20L12 2zm0 4.5l6.5 13H5.5L12 6.5z"/>
            </svg>
            <div class="nav-label">Софт</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram?.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }

            // === Навигация ===
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelector('.nav-item.active').classList.remove('active');
                    item.classList.add('active');
                    document.querySelector('.page.active').classList.remove('active');
                    document.getElementById(item.dataset.page).classList.add('active');
                });
            });

            // === Профиль ===
            const user = window.Telegram?.WebApp?.initDataUnsafe?.user || null;
            const avatarEl = document.getElementById('user-avatar');
            const nameEl = document.getElementById('user-name');

            let displayName = '// @unknown //';
            let photoUrl = 'https://i.ibb.co/0jKX7YJ/sunflower-avatar.jpg';

            if (user) {
                displayName = user.username ? `// @${user.username} //` : `// ${user.first_name || 'User'} ${user.last_name || ''} //`.trim();
                if (user.photo_url) photoUrl = user.photo_url;
            } else {
                displayName = '// @XaneZy //';
            }

            nameEl.textContent = displayName;
            avatarEl.src = photoUrl;

            // Первый вход
            let firstEntry = localStorage.getItem('firstEntry');
            if (!firstEntry) {
                const n = new Date();
                firstEntry = `${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,'0')}.${String(n.getDate()).padStart(2,'0')}, ${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
                localStorage.setItem('firstEntry', firstEntry);
            }
            document.getElementById('first-entry').textContent = `Первый вход: ${firstEntry}`;

            // === Rocket Predictor ===
            const btn = document.getElementById('start-predict');
            const multiplierEl = document.getElementById('multiplier');
            const statusEl = document.getElementById('status');
            const rocketEl = document.getElementById('rocket');

            btn.addEventListener('click', () => {
                btn.disabled = true;
                btn.textContent = "Запуск...";
                statusEl.textContent = "Ракета взлетает...";
                multiplierEl.textContent = "1.00×";
                rocketEl.style.bottom = "20px";

                let current = 1.00;
                const interval = setInterval(() => {
                    current += Math.random() * 0.04;
                    if (current > 1.50) current = 1.50; // Жёсткий лимит 1.50×
                    multiplierEl.textContent = current.toFixed(2) + "×";
                    rocketEl.style.bottom = (20 + (current - 1) * 300) + "px";
                }, 120);

                const crashAt = 1 + Math.random() * 0.50; // от 1.00 до 1.50
                const timeToCrash = 800 + Math.random() * 2200; // 0.8–3 сек

                setTimeout(() => {
                    clearInterval(interval);
                    multiplierEl.textContent = crashAt.toFixed(2) + "×";
                    statusEl.textContent = `Ракета упала на ${crashAt.toFixed(2)}×`;
                    rocketEl.style.bottom = "-100px";
                    btn.disabled = false;
                    btn.textContent = "Новый прогноз";
                }, timeToCrash);
            });
        });
    </script>
</body>
</html>
